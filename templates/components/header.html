<!-- Header Component -->
<header class="sticky-top bg-white border-bottom" style="border-color: var(--border) !important;">
    <nav class="navbar navbar-expand-lg py-3">
        <div class="container">
            <!-- Logo -->
            <a class="navbar-brand d-flex align-items-center gap-3" href="{% url 'home' %}">
                <div class="jema-gradient rounded-circle d-flex align-items-center justify-content-center"
                    style="width: 48px; height: 48px;">
                    <i class="bi bi-shop text-white fs-5"></i>
                </div>
                <span class="fw-bold fs-4 jema-text-gradient">JEMA</span>
            </a>

            <!-- Mobile Toggle -->
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
                <i class="bi bi-list fs-4" style="color: var(--jema-purple);"></i>
            </button>

            <!-- Navigation -->
            <div class="collapse navbar-collapse" id="mainNav">
                <ul class="navbar-nav mx-auto gap-2">
                    <li class="nav-item">
                        <a class="nav-link px-3 py-2 rounded-3 fw-medium {% if request.path == '/' %}active bg-light{% endif %}"
                            href="{% url 'home' %}" style="color: var(--foreground);">
                            Inicio
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link px-3 py-2 rounded-3 fw-medium {% if 'catalogo' in request.path %}active bg-light{% endif %}"
                            href="{% url 'catalogo' %}" style="color: var(--foreground);">
                            Catálogo
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link px-3 py-2 rounded-3 fw-medium" href="#" style="color: var(--foreground);">
                            Ofertas
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link px-3 py-2 rounded-3 fw-medium" href="#" style="color: var(--foreground);">
                            Contacto
                        </a>
                    </li>
                </ul>

                <!-- Actions -->
                <div class="d-flex align-items-center gap-3 mt-3 mt-lg-0">
                    <!-- Search -->
                    <button class="btn btn-light rounded-circle p-2" style="width: 44px; height: 44px;">
                        <i class="bi bi-search" style="color: var(--muted-foreground);"></i>
                    </button>

                    <!-- Cart -->
                    <button class="btn btn-light rounded-circle p-2 position-relative"
                        style="width: 44px; height: 44px;">
                        <i class="bi bi-cart3" style="color: var(--muted-foreground);"></i>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill"
                            style="background-color: var(--jema-magenta); font-size: 0.65rem;">
                            3
                        </span>
                    </button>

                    <!-- User Menu -->
                    <div class="dropdown">
                        <button class="btn btn-light rounded-circle p-2 dropdown-toggle-no-caret"
                            style="width: 44px; height: 44px;" data-bs-toggle="dropdown">
                            <i class="bi bi-person" style="color: var(--muted-foreground);"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0 rounded-3 p-2"
                            style="min-width: 200px;">
                            {% if user.is_authenticated %}
                            <!-- Si el usuario ESTÁ logueado -->
                            <li>
                                <div class="dropdown-header">
                                    Hola, {{ user.username }}
                                </div>
                            </li>
                            {% if user.is_staff or user.is_superuser %}
                            <li>
                                <a class="dropdown-item rounded-2 py-2 px-3" href="{% url 'panel_home' %}">
                                    <i class="bi bi-gear me-2 text-jema-magenta"></i>
                                    Panel Admin
                                </a>
                            </li>
                            {% endif %}
                            <li>
                                <hr class="dropdown-divider my-2">
                            </li>
                            <li>
                                <form method="post" action="{% url 'account_logout' %}">
                                    {% csrf_token %}
                                    <button type="submit" class="dropdown-item rounded-2 py-2 px-3 text-danger">
                                        <i class="bi bi-box-arrow-right me-2"></i> Cerrar Sesión
                                    </button>
                                </form>
                            </li>
                            {% else %}
                            <!-- Si el usuario NO está logueado -->
                            <li>
                                <a class="dropdown-item rounded-2 py-2 px-3" href="{% url 'account_login' %}">
                                    <i class="bi bi-box-arrow-in-right me-2 text-jema-purple"></i>
                                    Iniciar Sesión
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item rounded-2 py-2 px-3"
                                    href="{% url 'account_login' %}?tab=register">
                                    <i class="bi bi-person-plus me-2 text-jema-teal"></i>
                                    Registrarse
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>
</header>

<style>
    .nav-link.active {
        color: var(--jema-purple) !important;
        font-weight: 600 !important;
    }

    .nav-link:hover {
        background-color: var(--muted);
        color: var(--jema-purple) !important;
    }

    .dropdown-item:hover {
        background-color: var(--muted);
    }

    .dropdown-toggle-no-caret::after {
        display: none;
    }
</style>