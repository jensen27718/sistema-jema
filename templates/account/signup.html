{% extends 'base.html' %}
{% load socialaccount %}

{% block title %}Registrarse - JEMA{% endblock %}

{% block content %}
<div class="min-vh-100 d-flex align-items-center justify-content-center py-5"
    style="background: linear-gradient(135deg, rgba(107, 45, 123, 0.05) 0%, rgba(26, 154, 154, 0.05) 100%);">

    <!-- Decorative elements -->
    <div class="position-fixed"
        style="width: 400px; height: 400px; background: radial-gradient(circle, rgba(107, 45, 123, 0.1) 0%, transparent 70%); top: -100px; right: -100px; border-radius: 50%; pointer-events: none;">
    </div>
    <div class="position-fixed"
        style="width: 300px; height: 300px; background: radial-gradient(circle, rgba(26, 154, 154, 0.1) 0%, transparent 70%); bottom: -50px; left: -50px; border-radius: 50%; pointer-events: none;">
    </div>

    <div class="container position-relative" style="z-index: 1;">
        <div class="row justify-content-center">
            <div class="col-lg-5 col-md-7">
                <div class="jema-card p-5 shadow-lg">
                    <!-- Logo -->
                    <div class="text-center mb-4">
                        <a href="{% url 'home' %}" class="d-inline-flex align-items-center gap-3 text-decoration-none">
                            <div class="jema-gradient rounded-circle d-flex align-items-center justify-content-center"
                                style="width: 56px; height: 56px;">
                                <i class="bi bi-shop text-white fs-4"></i>
                            </div>
                            <span class="fw-bold fs-3 jema-text-gradient">JEMA</span>
                        </a>
                    </div>

                    <!-- MENSAJES DE ERROR (Crítico para ver por qué falló el registro) -->
                    {% if form.errors %}
                    <div class="alert alert-danger rounded-3 mb-4 border-0 shadow-sm">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        <span class="fw-bold">Por favor corrige lo siguiente:</span>
                        <ul class="mb-0 mt-2 ps-3 small">
                            {% for field in form %}
                            {% for error in field.errors %}
                            <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                            {% endfor %}
                            {% endfor %}
                            {% for error in form.non_field_errors %}
                            <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}

                    <!-- Tabs -->
                    <ul class="nav nav-pills nav-justified mb-4 p-1 rounded-3" style="background-color: var(--muted);"
                        id="authTabs">
                        <li class="nav-item">
                            <!-- Pestaña INACTIVA (Login) -->
                            <button class="nav-link w-100 py-3 fw-medium rounded-3" data-bs-toggle="pill"
                                data-bs-target="#login-tab">
                                Iniciar Sesión
                            </button>
                        </li>
                        <li class="nav-item">
                            <!-- Pestaña ACTIVA (Registro) -->
                            <button class="nav-link active w-100 py-3 fw-medium rounded-3" data-bs-toggle="pill"
                                data-bs-target="#register-tab">
                                Registrarse
                            </button>
                        </li>
                    </ul>

                    <div class="tab-content">
                        <!-- ================= LOGIN TAB (Oculto por defecto) ================= -->
                        <div class="tab-pane fade" id="login-tab">
                            <form method="post" action="{% url 'account_login' %}">
                                {% csrf_token %}

                                <div class="mb-4">
                                    <label class="form-label fw-medium">Correo Electrónico</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-transparent border-end-0 rounded-start-3"
                                            style="border: 2px solid var(--border); border-right: none;">
                                            <i class="bi bi-envelope text-muted"></i>
                                        </span>
                                        <input type="email" name="login"
                                            class="form-control border-start-0 rounded-end-3 py-3"
                                            placeholder="tu@email.com"
                                            style="border: 2px solid var(--border); border-left: none; font-size: 1.1rem;"
                                            required>
                                    </div>
                                </div>

                                <div class="mb-4">
                                    <label class="form-label fw-medium">Contraseña</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-transparent border-end-0 rounded-start-3"
                                            style="border: 2px solid var(--border); border-right: none;">
                                            <i class="bi bi-lock text-muted"></i>
                                        </span>
                                        <input type="password" name="password"
                                            class="form-control border-start-0 border-end-0 py-3" placeholder="••••••••"
                                            style="border: 2px solid var(--border); border-left: none; border-right: none; font-size: 1.1rem;"
                                            required>
                                        <button type="button"
                                            class="input-group-text bg-transparent border-start-0 rounded-end-3"
                                            style="border: 2px solid var(--border); border-left: none;"
                                            onclick="togglePassword(this)">
                                            <i class="bi bi-eye text-muted"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="remember" name="remember"
                                            style="border-color: var(--jema-purple);">
                                        <label class="form-check-label" for="remember">Recordarme</label>
                                    </div>
                                    <a href="{% url 'account_reset_password' %}"
                                        class="text-jema-purple text-decoration-none fw-medium">
                                        ¿Olvidaste tu contraseña?
                                    </a>
                                </div>

                                <button type="submit" class="btn btn-jema-primary w-100 py-3 mb-4">
                                    <i class="bi bi-box-arrow-in-right me-2"></i>
                                    Iniciar Sesión
                                </button>
                            </form>

                            <!-- Divider -->
                            <div class="d-flex align-items-center gap-3 mb-4">
                                <hr class="flex-grow-1" style="border-color: var(--border);">
                                <span class="text-muted small">o continúa con</span>
                                <hr class="flex-grow-1" style="border-color: var(--border);">
                            </div>

                            <!-- Social Login -->
                            <a href="{% provider_login_url 'google' %}"
                                class="btn btn-outline-secondary w-100 py-3 d-flex align-items-center justify-content-center gap-2">
                                <svg width="20" height="20" viewBox="0 0 24 24">
                                    <path fill="#4285F4"
                                        d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
                                    <path fill="#34A853"
                                        d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
                                    <path fill="#FBBC05"
                                        d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
                                    <path fill="#EA4335"
                                        d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
                                </svg>
                                Iniciar con Google
                            </a>
                        </div>

                        <!-- ================= REGISTER TAB (Visible por defecto) ================= -->
                        <div class="tab-pane fade show active" id="register-tab">
                            <form method="post" action="{% url 'account_signup' %}">
                                {% csrf_token %}

                                <div class="mb-4">
                                    <label class="form-label fw-medium">Nombre Completo</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-transparent border-end-0 rounded-start-3"
                                            style="border: 2px solid var(--border); border-right: none;">
                                            <i class="bi bi-person text-muted"></i>
                                        </span>
                                        <input type="text" name="fullname" value="{{ form.fullname.value|default:'' }}"
                                            class="form-control border-start-0 rounded-end-3 py-3"
                                            placeholder="Tu nombre completo"
                                            style="border: 2px solid var(--border); border-left: none; font-size: 1.1rem;"
                                            required>
                                    </div>
                                </div>

                                <div class="mb-4">
                                    <label class="form-label fw-medium">Correo Electrónico</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-transparent border-end-0 rounded-start-3"
                                            style="border: 2px solid var(--border); border-right: none;">
                                            <i class="bi bi-envelope text-muted"></i>
                                        </span>
                                        <input type="email" name="email" value="{{ form.email.value|default:'' }}"
                                            class="form-control border-start-0 rounded-end-3 py-3"
                                            placeholder="tu@email.com"
                                            style="border: 2px solid var(--border); border-left: none; font-size: 1.1rem;"
                                            required>
                                    </div>
                                </div>

                                <div class="mb-4">
                                    <label class="form-label fw-medium">Contraseña</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-transparent border-end-0 rounded-start-3"
                                            style="border: 2px solid var(--border); border-right: none;">
                                            <i class="bi bi-lock text-muted"></i>
                                        </span>
                                        <input type="password" name="password1"
                                            class="form-control border-start-0 border-end-0 py-3"
                                            placeholder="Mínimo 8 caracteres"
                                            style="border: 2px solid var(--border); border-left: none; border-right: none; font-size: 1.1rem;"
                                            required minlength="8">
                                        <button type="button"
                                            class="input-group-text bg-transparent border-start-0 rounded-end-3"
                                            style="border: 2px solid var(--border); border-left: none;"
                                            onclick="togglePassword(this)">
                                            <i class="bi bi-eye text-muted"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="mb-4">
                                    <label class="form-label fw-medium">Confirmar Contraseña</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-transparent border-end-0 rounded-start-3"
                                            style="border: 2px solid var(--border); border-right: none;">
                                            <i class="bi bi-lock-fill text-muted"></i>
                                        </span>
                                        <input type="password" name="password2"
                                            class="form-control border-start-0 rounded-end-3 py-3"
                                            placeholder="Repite tu contraseña"
                                            style="border: 2px solid var(--border); border-left: none; font-size: 1.1rem;"
                                            required>
                                    </div>
                                </div>

                                <div class="form-check mb-4">
                                    <input class="form-check-input" type="checkbox" id="terms" name="terms" required
                                        style="border-color: var(--jema-purple);">
                                    <label class="form-check-label" for="terms">
                                        Acepto los <a href="#" class="text-jema-purple">términos y condiciones</a>
                                    </label>
                                </div>

                                <button type="submit" class="btn btn-jema-primary w-100 py-3 mb-4">
                                    <i class="bi bi-person-plus me-2"></i>
                                    Crear Cuenta
                                </button>
                            </form>

                            <!-- Divider -->
                            <div class="d-flex align-items-center gap-3 mb-4">
                                <hr class="flex-grow-1" style="border-color: var(--border);">
                                <span class="text-muted small">o regístrate con</span>
                                <hr class="flex-grow-1" style="border-color: var(--border);">
                            </div>

                            <!-- Social Register -->
                            <a href="{% provider_login_url 'google' %}" type="button"
                                class="btn btn-outline-secondary w-100 py-3 d-flex align-items-center justify-content-center gap-2">
                                <svg width="20" height="20" viewBox="0 0 24 24">
                                    <path fill="#4285F4"
                                        d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
                                    <path fill="#34A853"
                                        d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
                                    <path fill="#FBBC05"
                                        d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
                                    <path fill="#EA4335"
                                        d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
                                </svg>
                                Registrarse con Google
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .nav-pills .nav-link {
        color: var(--muted-foreground);
        transition: all 0.3s ease;
    }

    .nav-pills .nav-link.active {
        background: linear-gradient(135deg, var(--jema-purple) 0%, var(--jema-teal) 100%);
        color: white;
    }

    .form-check-input:checked {
        background-color: var(--jema-purple);
        border-color: var(--jema-purple);
    }
</style>

<script>
    function togglePassword(button) {
        const input = button.previousElementSibling;
        const icon = button.querySelector('i');

        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.remove('bi-eye');
            icon.classList.add('bi-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.remove('bi-eye-slash');
            icon.classList.add('bi-eye');
        }
    }
</script>
{% endblock %}